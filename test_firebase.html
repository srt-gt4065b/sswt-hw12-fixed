<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Firebase Test</title>
</head>
<body>
    <h1>Firebase Data Test</h1>
    <button onclick="testLoad()">Test Load Data</button>
    <div id="result"></div>

<script type="module">
const firebaseConfig = {
    apiKey: "AIzaSyDKHFod7Hr8qeUgUb052Ir3DCxF0ZRb6To",
    authDomain: "sswt2025fall.firebaseapp.com",
    databaseURL: "https://sswt2025fall-default-rtdb.asia-southeast1.firebasedatabase.app",
    projectId: "sswt2025fall",
    storageBucket: "sswt2025fall.firebasestorage.app",
    messagingSenderId: "304733564282",
    appId: "1:304733564282:web:e8ec392e6fe4bf871dbac3"
};

let database = null;

try {
    const { initializeApp } = await import("https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js");
    const { getDatabase, ref, get } = await import("https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js");
    
    const app = initializeApp(firebaseConfig);
    database = getDatabase(app);
    
    console.log("âœ… Firebase connected!");
    
    window.testLoad = async function() {
        const resultDiv = document.getElementById("result");
        resultDiv.innerHTML = "Loading...";
        
        try {
            const scoresRef = ref(database, "scores");
            const snapshot = await get(scoresRef);
            
            if (!snapshot.exists()) {
                resultDiv.innerHTML = "No data found!";
                return;
            }
            
            const result = [];
            snapshot.forEach(child => result.push(child.val()));
            
            resultDiv.innerHTML = `
                <h2>Total Records: ${result.length}</h2>
                <h3>Unique Students:</h3>
                <pre>${JSON.stringify([...new Set(result.map(r => r.playerName))], null, 2)}</pre>
                <h3>Sample Records:</h3>
                <pre>${JSON.stringify(result.slice(0, 10), null, 2)}</pre>
            `;
            
            console.log("Total records:", result.length);
            console.log("Sample:", result.slice(0, 5));
            
        } catch (err) {
            resultDiv.innerHTML = "Error: " + err.message;
            console.error(err);
        }
    };
    
} catch (err) {
    console.error("Firebase init error:", err);
    document.getElementById("result").innerHTML = "Firebase connection failed: " + err.message;
}
</script>
</body>
</html>
